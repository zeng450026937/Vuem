(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("vue")):"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["Vuem"]=e(require("vue")):t["Vuem"]=e(t["Vue"])})(window,function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(e,n){e.exports=t},function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r);function o(t,e,n,r,i,o,u){try{var a=t[o](u),s=a.value}catch(c){return void n(c)}a.done?e(s):Promise.resolve(s).then(r,i)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var u=t.apply(e,n);function a(t){o(u,r,i,a,s,"next",t)}function s(t){o(u,r,i,a,s,"throw",t)}a(void 0)})}}function a(t){if(!Array.isArray(t))throw new TypeError("Middleware stack must be an array!");return t.forEach(function(t){if("function"!==typeof t)throw new TypeError("Middleware must be composed of functions!")}),function(e,n){var r=-1;return i(0);function i(t){return o.apply(this,arguments)}function o(){return o=u(regeneratorRuntime.mark(function o(u){var a;return regeneratorRuntime.wrap(function(o){while(1)switch(o.prev=o.next){case 0:if(!(u<=r)){o.next=2;break}throw new Error("next() called multiple times");case 2:if(r=u,a=t[u],u===t.length&&(a=n),a){o.next=7;break}return o.abrupt("return");case 7:return o.abrupt("return",a(e,i.bind(null,u+1)));case 8:case"end":return o.stop()}},o,this)})),o.apply(this,arguments)}}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}var l=function(){function t(){s(this,t)}return f(t,[{key:"toJSON",value:function(){return{ns:this.ns,method:this.method,payload:this.payload}}}]),t}();function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&p(t.prototype,e),n&&p(t,n),t}var y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h(this,t),this.ns=e,this.middleware=[]}return d(t,[{key:"match",value:function(t){return!this.ns||this.ns===t}},{key:"use",value:function(t){var e=this;if("function"!==typeof t)throw new TypeError("middleware must be a function!");return this.middleware.push(function(n,r){return t.call(e.vm,n,r)}),this}},{key:"register",value:function(t,e){var n=this;if("undefined"===typeof e)return e=t,t=null,this.use(e);var r=function(r,i){return!1===r.ns||n.ns.startsWith(r.ns)?r.method!==t?i():e.call(n.vm,r,i):i()};return r.method=t,this.use(r)}},{key:"callback",value:function(){var t=this;return function(e,n){if(!1!==e.ns&&!t.match(e.ns))return n?n():Promise.resolve();e.model=e.layer=t,e.vm=t.vm||e.vm;var r=a(t.middleware);return r(e,n)}}},{key:"dispatch",value:function(t,e,n){return n=n||this.createContext(),n.method=t,n.payload=e||{},this.callback()(n)}},{key:"createContext",value:function(){var t=new l;return t.layer=this,t.ns=this.ns,t}}]),t}();function b(t){return b="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function v(t,e){return g(t)||w(t,e)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function w(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done);r=!0)if(n.push(u.value),e&&n.length===e)break}catch(s){i=!0,o=s}finally{try{r||null==a["return"]||a["return"]()}finally{if(i)throw o}}return n}function g(t){if(Array.isArray(t))return t}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function j(t,e,n){return e&&O(t.prototype,e),n&&O(t,n),t}function x(t,e){return!e||"object"!==b(e)&&"function"!==typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $(t,e,n){return $="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=P(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},$(t,e,n||t)}function P(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=S(t),null===t)break;return t}function S(t){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},S(t)}function _(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}function M(t,e){return M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},M(t,e)}var C=i.a.config.optionMergeStrategies;C.middleware=C.methods,C.subscribe=C.methods;var T,V=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return k(this,e),t=x(this,S(e).call(this,n)),t.parent=null,t.submodel={},t.mixins=[],t.data={},t.computed={},t.watch={},t.trigger={},t.vm=null,t}return _(e,t),j(e,[{key:"initialized",value:function(){return!!this.vm}},{key:"mount",value:function(t,n){if(!(n instanceof e))throw new TypeError("model must be an instance of Model");return this.submodel[t]&&console.warn("already has model for ".concat(t)),n.setNS(this.genNS(t)),n.setParent(this),this.submodel[t]=n,this}},{key:"model",value:function(t){if(!t)return this;var n=this.submodel[t];return n||(n=new e,this.mount(t,n)),n}},{key:"up",value:function(){return this.parent||this}},{key:"provide",value:function(t,e){return t&&"undefined"===typeof e&&(this.mixins.push(t),t=null),t?(this.computed[t]&&console.warn("duplicate provided key"),"function"===typeof e?this.computed[t]=e:this.data[t]=e,this):this}},{key:"hook",value:function(t,e){return this.initialized()?(this.vm.$watch(t,e),this):(this.watch[t]=this.watch[t]||[],this.watch[t].push(e),this)}},{key:"subscribe",value:function(t,e){var n=this;return this.initialized()?(this.vm.$root.$on(t,function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.apply(n.vm,r)}),this):(this.trigger[t]=this.trigger[t]||[],this.trigger[t].push(e),this)}},{key:"broadcast",value:function(){var t;return this.initialized()?((t=this.vm.$root).$emit.apply(t,arguments),this):(console.warn("broadcast() can only be used when initialized"),this)}},{key:"getVM",value:function(t){if(this.initialized()){var e=this.vm;return t&&(e=t.split(".").reduce(function(t,e){return t[e]},e)),e}console.warn("getVM() can only be used when initialized")}},{key:"setNS",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.ns=e,Object.keys(this.submodel).forEach(function(e){t.submodel[e].setNS(t.genNS(e))})}},{key:"setParent",value:function(t){this.parent=t}},{key:"genNS",value:function(t){var e=t;return!1!==this.ns&&(e="".concat(this.ns,".").concat(t)),e}},{key:"genVM",value:function(t){var e=this;return new i.a({parent:t,mixins:this.mixins,data:this.data,computed:this.computed,watch:this.watch,beforeCreate:function(){this.$kom=e.root,this.$getVM=e.root.getVM.bind(e.root),this.$dispatch=e.root.dispatch.bind(e.root),this.$broadcast=e.broadcast.bind(e)}})}},{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.initialized()||e){this.vm&&(this.middleware=this.middleware.filter(function(t){return!t.method}));var n=Object.keys(this.submodel);n.forEach(function(e){t.data[e]=t.data[e]}),this.vm=this.genVM(this.parent&&this.parent.vm);var r=this.vm.$options,i=r.middleware,o=r.subscribe;return i&&Object.keys(i).forEach(function(e){return t.register(e,i[e])}),o&&Object.keys(o).forEach(function(e){return t.subscribe(e,o[e])}),Object.entries(this.trigger).forEach(function(e){var n=v(e,2),r=n[0],i=n[1];i.forEach(function(e){return t.subscribe(r,e)})}),n.forEach(function(e){var n=t.submodel[e];n.init(),t.use(n.callback()),t.data[e]=n.vm}),this}}},{key:"destroy",value:function(){var t=this;this.initialized()&&(Object.keys(this.submodel).forEach(function(e){return t.submodel[e].destroy()}),this.vm.$destroy())}},{key:"match",value:function(t){return $(S(e.prototype),"match",this).call(this,t)||t.startsWith(this.ns)||this.ns.startsWith(t)}},{key:"dispatch",value:function(t,n,r){var i=-1;t&&(i=t.lastIndexOf(".")),"undefined"===typeof r&&-1!==i&&(r=t.substring(0,i),t=t.substring(i+1));var o=this.createContext(r||!1);return $(S(e.prototype),"dispatch",this).call(this,t,n,o)}},{key:"createContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ns;t&&this.ns&&!t.startsWith(this.ns)&&(t="".concat(this.ns,".").concat(t));var n=$(S(e.prototype),"createContext",this).call(this);return n.model=this,n.vm=this.vm,n.ns=t,n}},{key:"root",get:function(){return this.parent?this.parent.root:this}}]),e}(y);function R(t){return R="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){return!e||"object"!==R(e)&&"function"!==typeof e?N(t):e}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function W(t,e,n){return W="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=D(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}},W(t,e,n||t)}function D(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=q(t),null===t)break;return t}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},q(t)}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function J(t,e,n){return e&&I(t.prototype,e),n&&I(t,n),t}function L(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}function B(t,e){return B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},B(t,e)}n.d(e,"default",function(){return F}),n.d(e,"Model",function(){return V}),n.d(e,"Layer",function(){return y});var F=function(t){function e(){var t;return z(this,e),t=A(this,q(e).call(this)),t.d={},t}return L(e,t),J(e,null,[{key:"install",value:function(t){T&&T===t||(T=t,T.mixin({beforeCreate:function(){var t=this,n=this.$options,r=n.kom||n.parent&&n.parent.$kom;if(r){var i=r instanceof e;if(!i)return console.warn("only kom is accepted.");r.init(),this.$kom=r,this.$model=r.vm,this.$getVM=r.getVM.bind(r),this.$dispatch=r.dispatch.bind(r),this.$broadcast=r.vm.$emit.bind(r.vm),this.$subscribe=r.vm.$on.bind(r.vm),this.$unsubscribe=r.vm.$off.bind(r.vm);var o=n.subscribe;o&&(this._subscribe={},Object.keys(o).forEach(function(e){var n=t._subscribe[e]=o[e].bind(t);t.$subscribe(e,n)}));var u=n.sketch;u&&(Array.isArray(u)||(u=[u]),u.forEach(function(t){return a(t)}))}function a(t){var e=t.ns,i=t.props,o=void 0===i?[]:i,u=r.vm;e&&(u=e.split(".").reduce(function(t,e){return t[e]},u)),o.length>0&&(n.computed=n.computed||{}),o.forEach(function(t){n.computed[t]||(n.computed[t]={get:function(){return u[t]},set:function(e){u[t]=e}})})}},beforeDestroy:function(){var t=this,e=this.$options,n=e.kom||e.parent&&e.parent.$kom;if(n){var r=this._subscribe;r&&Object.keys(r).forEach(function(e){t.$unsubscribe(e,r[e])})}}}))}}]),J(e,[{key:"get",value:function(t){return this.d[t]}},{key:"set",value:function(t,e){this.d[t]=e}},{key:"createContext",value:function(t){var n=W(q(e.prototype),"createContext",this).call(this,t);return n.kom=this,n.getVM=this.getVM.bind(this),n.isMatch=function(){return this.ns===this.model.ns},n}}]),e}(V)}])});